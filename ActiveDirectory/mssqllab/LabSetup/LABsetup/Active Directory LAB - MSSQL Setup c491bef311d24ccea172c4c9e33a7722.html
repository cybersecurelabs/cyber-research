<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Active Directory LAB - MSSQL Setup</title><style>
/* cspell:disable-file */
/* webkit printing magic: print all background colors */
html {
	-webkit-print-color-adjust: exact;
}
* {
	box-sizing: border-box;
	-webkit-print-color-adjust: exact;
}

html,
body {
	margin: 0;
	padding: 0;
}
@media only screen {
	body {
		margin: 2em auto;
		max-width: 900px;
		color: rgb(55, 53, 47);
	}
}

body {
	line-height: 1.5;
	white-space: pre-wrap;
}

a,
a.visited {
	color: inherit;
	text-decoration: underline;
}

.pdf-relative-link-path {
	font-size: 80%;
	color: #444;
}

h1,
h2,
h3 {
	letter-spacing: -0.01em;
	line-height: 1.2;
	font-weight: 600;
	margin-bottom: 0;
}

.page-title {
	font-size: 2.5rem;
	font-weight: 700;
	margin-top: 0;
	margin-bottom: 0.75em;
}

h1 {
	font-size: 1.875rem;
	margin-top: 1.875rem;
}

h2 {
	font-size: 1.5rem;
	margin-top: 1.5rem;
}

h3 {
	font-size: 1.25rem;
	margin-top: 1.25rem;
}

.source {
	border: 1px solid #ddd;
	border-radius: 3px;
	padding: 1.5em;
	word-break: break-all;
}

.callout {
	border-radius: 3px;
	padding: 1rem;
}

figure {
	margin: 1.25em 0;
	page-break-inside: avoid;
}

figcaption {
	opacity: 0.5;
	font-size: 85%;
	margin-top: 0.5em;
}

mark {
	background-color: transparent;
}

.indented {
	padding-left: 1.5em;
}

hr {
	background: transparent;
	display: block;
	width: 100%;
	height: 1px;
	visibility: visible;
	border: none;
	border-bottom: 1px solid rgba(55, 53, 47, 0.09);
}

img {
	max-width: 100%;
}

@media only print {
	img {
		max-height: 100vh;
		object-fit: contain;
	}
}

@page {
	margin: 1in;
}

.collection-content {
	font-size: 0.875rem;
}

.column-list {
	display: flex;
	justify-content: space-between;
}

.column {
	padding: 0 1em;
}

.column:first-child {
	padding-left: 0;
}

.column:last-child {
	padding-right: 0;
}

.table_of_contents-item {
	display: block;
	font-size: 0.875rem;
	line-height: 1.3;
	padding: 0.125rem;
}

.table_of_contents-indent-1 {
	margin-left: 1.5rem;
}

.table_of_contents-indent-2 {
	margin-left: 3rem;
}

.table_of_contents-indent-3 {
	margin-left: 4.5rem;
}

.table_of_contents-link {
	text-decoration: none;
	opacity: 0.7;
	border-bottom: 1px solid rgba(55, 53, 47, 0.18);
}

table,
th,
td {
	border: 1px solid rgba(55, 53, 47, 0.09);
	border-collapse: collapse;
}

table {
	border-left: none;
	border-right: none;
}

th,
td {
	font-weight: normal;
	padding: 0.25em 0.5em;
	line-height: 1.5;
	min-height: 1.5em;
	text-align: left;
}

th {
	color: rgba(55, 53, 47, 0.6);
}

ol,
ul {
	margin: 0;
	margin-block-start: 0.6em;
	margin-block-end: 0.6em;
}

li > ol:first-child,
li > ul:first-child {
	margin-block-start: 0.6em;
}

ul > li {
	list-style: disc;
}

ul.to-do-list {
	text-indent: -1.7em;
}

ul.to-do-list > li {
	list-style: none;
}

.to-do-children-checked {
	text-decoration: line-through;
	opacity: 0.375;
}

ul.toggle > li {
	list-style: none;
}

ul {
	padding-inline-start: 1.7em;
}

ul > li {
	padding-left: 0.1em;
}

ol {
	padding-inline-start: 1.6em;
}

ol > li {
	padding-left: 0.2em;
}

.mono ol {
	padding-inline-start: 2em;
}

.mono ol > li {
	text-indent: -0.4em;
}

.toggle {
	padding-inline-start: 0em;
	list-style-type: none;
}

/* Indent toggle children */
.toggle > li > details {
	padding-left: 1.7em;
}

.toggle > li > details > summary {
	margin-left: -1.1em;
}

.selected-value {
	display: inline-block;
	padding: 0 0.5em;
	background: rgba(206, 205, 202, 0.5);
	border-radius: 3px;
	margin-right: 0.5em;
	margin-top: 0.3em;
	margin-bottom: 0.3em;
	white-space: nowrap;
}

.collection-title {
	display: inline-block;
	margin-right: 1em;
}

.simple-table {
	margin-top: 1em;
	font-size: 0.875rem;
	empty-cells: show;
}
.simple-table td {
	height: 29px;
	min-width: 120px;
}

.simple-table th {
	height: 29px;
	min-width: 120px;
}

.simple-table-header-color {
	background: rgb(247, 246, 243);
	color: black;
}
.simple-table-header {
	font-weight: 500;
}

time {
	opacity: 0.5;
}

.icon {
	display: inline-block;
	max-width: 1.2em;
	max-height: 1.2em;
	text-decoration: none;
	vertical-align: text-bottom;
	margin-right: 0.5em;
}

img.icon {
	border-radius: 3px;
}

.user-icon {
	width: 1.5em;
	height: 1.5em;
	border-radius: 100%;
	margin-right: 0.5rem;
}

.user-icon-inner {
	font-size: 0.8em;
}

.text-icon {
	border: 1px solid #000;
	text-align: center;
}

.page-cover-image {
	display: block;
	object-fit: cover;
	width: 100%;
	max-height: 30vh;
}

.page-header-icon {
	font-size: 3rem;
	margin-bottom: 1rem;
}

.page-header-icon-with-cover {
	margin-top: -0.72em;
	margin-left: 0.07em;
}

.page-header-icon img {
	border-radius: 3px;
}

.link-to-page {
	margin: 1em 0;
	padding: 0;
	border: none;
	font-weight: 500;
}

p > .user {
	opacity: 0.5;
}

td > .user,
td > time {
	white-space: nowrap;
}

input[type="checkbox"] {
	transform: scale(1.5);
	margin-right: 0.6em;
	vertical-align: middle;
}

p {
	margin-top: 0.5em;
	margin-bottom: 0.5em;
}

.image {
	border: none;
	margin: 1.5em 0;
	padding: 0;
	border-radius: 0;
	text-align: center;
}

.code,
code {
	background: rgba(135, 131, 120, 0.15);
	border-radius: 3px;
	padding: 0.2em 0.4em;
	border-radius: 3px;
	font-size: 85%;
	tab-size: 2;
}

code {
	color: #eb5757;
}

.code {
	padding: 1.5em 1em;
}

.code-wrap {
	white-space: pre-wrap;
	word-break: break-all;
}

.code > code {
	background: none;
	padding: 0;
	font-size: 100%;
	color: inherit;
}

blockquote {
	font-size: 1.25em;
	margin: 1em 0;
	padding-left: 1em;
	border-left: 3px solid rgb(55, 53, 47);
}

.bookmark {
	text-decoration: none;
	max-height: 8em;
	padding: 0;
	display: flex;
	width: 100%;
	align-items: stretch;
}

.bookmark-title {
	font-size: 0.85em;
	overflow: hidden;
	text-overflow: ellipsis;
	height: 1.75em;
	white-space: nowrap;
}

.bookmark-text {
	display: flex;
	flex-direction: column;
}

.bookmark-info {
	flex: 4 1 180px;
	padding: 12px 14px 14px;
	display: flex;
	flex-direction: column;
	justify-content: space-between;
}

.bookmark-image {
	width: 33%;
	flex: 1 1 180px;
	display: block;
	position: relative;
	object-fit: cover;
	border-radius: 1px;
}

.bookmark-description {
	color: rgba(55, 53, 47, 0.6);
	font-size: 0.75em;
	overflow: hidden;
	max-height: 4.5em;
	word-break: break-word;
}

.bookmark-href {
	font-size: 0.75em;
	margin-top: 0.25em;
}

.sans { font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"; }
.code { font-family: "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace; }
.serif { font-family: Lyon-Text, Georgia, ui-serif, serif; }
.mono { font-family: iawriter-mono, Nitti, Menlo, Courier, monospace; }
.pdf .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK JP'; }
.pdf:lang(zh-CN) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK SC'; }
.pdf:lang(zh-TW) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK TC'; }
.pdf:lang(ko-KR) .sans { font-family: Inter, ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol", 'Twemoji', 'Noto Color Emoji', 'Noto Sans CJK KR'; }
.pdf .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .code { font-family: Source Code Pro, "SFMono-Regular", Menlo, Consolas, "PT Mono", "Liberation Mono", Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.pdf .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK JP'; }
.pdf:lang(zh-CN) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK SC'; }
.pdf:lang(zh-TW) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK TC'; }
.pdf:lang(ko-KR) .serif { font-family: PT Serif, Lyon-Text, Georgia, ui-serif, serif, 'Twemoji', 'Noto Color Emoji', 'Noto Serif CJK KR'; }
.pdf .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK JP'; }
.pdf:lang(zh-CN) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK SC'; }
.pdf:lang(zh-TW) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK TC'; }
.pdf:lang(ko-KR) .mono { font-family: PT Mono, iawriter-mono, Nitti, Menlo, Courier, monospace, 'Twemoji', 'Noto Color Emoji', 'Noto Sans Mono CJK KR'; }
.highlight-default {
	color: rgba(55, 53, 47, 1);
}
.highlight-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.highlight-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.highlight-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.highlight-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.highlight-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.highlight-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.highlight-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.highlight-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.highlight-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.highlight-gray_background {
	background: rgba(241, 241, 239, 1);
}
.highlight-brown_background {
	background: rgba(244, 238, 238, 1);
}
.highlight-orange_background {
	background: rgba(251, 236, 221, 1);
}
.highlight-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.highlight-teal_background {
	background: rgba(237, 243, 236, 1);
}
.highlight-blue_background {
	background: rgba(231, 243, 248, 1);
}
.highlight-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.highlight-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.highlight-red_background {
	background: rgba(253, 235, 236, 1);
}
.block-color-default {
	color: inherit;
	fill: inherit;
}
.block-color-gray {
	color: rgba(120, 119, 116, 1);
	fill: rgba(120, 119, 116, 1);
}
.block-color-brown {
	color: rgba(159, 107, 83, 1);
	fill: rgba(159, 107, 83, 1);
}
.block-color-orange {
	color: rgba(217, 115, 13, 1);
	fill: rgba(217, 115, 13, 1);
}
.block-color-yellow {
	color: rgba(203, 145, 47, 1);
	fill: rgba(203, 145, 47, 1);
}
.block-color-teal {
	color: rgba(68, 131, 97, 1);
	fill: rgba(68, 131, 97, 1);
}
.block-color-blue {
	color: rgba(51, 126, 169, 1);
	fill: rgba(51, 126, 169, 1);
}
.block-color-purple {
	color: rgba(144, 101, 176, 1);
	fill: rgba(144, 101, 176, 1);
}
.block-color-pink {
	color: rgba(193, 76, 138, 1);
	fill: rgba(193, 76, 138, 1);
}
.block-color-red {
	color: rgba(212, 76, 71, 1);
	fill: rgba(212, 76, 71, 1);
}
.block-color-gray_background {
	background: rgba(241, 241, 239, 1);
}
.block-color-brown_background {
	background: rgba(244, 238, 238, 1);
}
.block-color-orange_background {
	background: rgba(251, 236, 221, 1);
}
.block-color-yellow_background {
	background: rgba(251, 243, 219, 1);
}
.block-color-teal_background {
	background: rgba(237, 243, 236, 1);
}
.block-color-blue_background {
	background: rgba(231, 243, 248, 1);
}
.block-color-purple_background {
	background: rgba(244, 240, 247, 0.8);
}
.block-color-pink_background {
	background: rgba(249, 238, 243, 0.8);
}
.block-color-red_background {
	background: rgba(253, 235, 236, 1);
}
.select-value-color-pink { background-color: rgba(245, 224, 233, 1); }
.select-value-color-purple { background-color: rgba(232, 222, 238, 1); }
.select-value-color-green { background-color: rgba(219, 237, 219, 1); }
.select-value-color-gray { background-color: rgba(227, 226, 224, 1); }
.select-value-color-opaquegray { background-color: rgba(255, 255, 255, 0.0375); }
.select-value-color-orange { background-color: rgba(250, 222, 201, 1); }
.select-value-color-brown { background-color: rgba(238, 224, 218, 1); }
.select-value-color-red { background-color: rgba(255, 226, 221, 1); }
.select-value-color-yellow { background-color: rgba(253, 236, 200, 1); }
.select-value-color-blue { background-color: rgba(211, 229, 239, 1); }

.checkbox {
	display: inline-flex;
	vertical-align: text-bottom;
	width: 16;
	height: 16;
	background-size: 16px;
	margin-left: 2px;
	margin-right: 5px;
}

.checkbox-on {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22%2358A9D7%22%2F%3E%0A%3Cpath%20d%3D%22M6.71429%2012.2852L14%204.9995L12.7143%203.71436L6.71429%209.71378L3.28571%206.2831L2%207.57092L6.71429%2012.2852Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fsvg%3E");
}

.checkbox-off {
	background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%3E%0A%3Crect%20x%3D%220.75%22%20y%3D%220.75%22%20width%3D%2214.5%22%20height%3D%2214.5%22%20fill%3D%22white%22%20stroke%3D%22%2336352F%22%20stroke-width%3D%221.5%22%2F%3E%0A%3C%2Fsvg%3E");
}
	
</style></head><body><article id="c491bef3-11d2-4cce-a172-c4c9e33a7722" class="page sans"><header><h1 class="page-title">Active Directory LAB - MSSQL Setup</h1></header><div class="page-body"><h2 id="0d73187c-2ed9-4dfc-95ad-4300d24f12d6" class="">LAB Setting up MSSQL Server and Vuln Web App </h2><p id="6223dd40-2706-474e-8530-c0a884c0ccf6" class="">
</p><p id="c2f52399-583d-4293-9a97-0c81155f0777" class="">By: CyberSec</p><p id="bebe51ba-7dad-4a51-a4f2-bb3b13f19fb6" class="">
</p><h3 id="b624aad0-2686-4d39-b6e5-b849f14b3710" class="">LAB Setup Pt 1</h3><p id="63f2feed-61aa-481c-90bc-d6f95d95ff4b" class="">
</p><p id="df81870d-0f88-422a-b775-0028fbee8082" class="">
</p><figure id="0be6fc0f-ac5f-441c-8136-d88e897fb5ff" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled.png"><img style="width:678px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled.png"/></a></figure><p id="90b9edb3-c14a-436c-99b1-072888666678" class="">
</p><p id="b378f8d9-cea0-4bd7-a08b-bdc07736968e" class="">
</p><p id="e32d1fb9-a948-4504-b092-93d29b24f011" class="">
</p><p id="c5bb1572-f799-44b1-a166-3375484d92a9" class=""><strong>LAB Setup: </strong></p><p id="12341c96-2dcb-4e9b-bce2-30325a5c7323" class="">
</p><p id="28f0ee96-7947-48f4-9988-bdb2d041365f" class=""><strong>Domain Controller:</strong> 192.168.0.21</p><p id="a614c922-ae45-4fa6-a701-fffe283af73f" class="">
</p><p id="0851c97d-47c7-48a8-957a-08462e8b9c05" class=""><strong>Domain Joined:</strong> SQL Server 192.168.0.35</p><p id="9d9d7e5e-a34e-472c-a866-787dc3df58e7" class="">
</p><p id="b7c11281-a715-47d2-a74b-bf939bcec8eb" class=""><strong>Client Computer (CLIENT1):</strong> 192.168.0.31</p><p id="298afad5-1b48-4c49-ac41-60529dff1955" class="">
</p><p id="9c9dc208-fc28-4afc-a4c5-15508502372c" class="">
</p><p id="5801e187-22d8-4525-b050-c35eb2084b29" class="">This lab assumes that the active directory lab environment is already configured.  A good resource to create a vulnerable AD Lab can be found at the below URL.</p><p id="03cf7761-b8b2-4355-b9aa-0ade4080a142" class="">
</p><p id="e2660aee-b69f-45ee-bdf9-56d49f9bb8c9" class=""><strong>URL:</strong> </p><figure id="88ff3147-cc7f-4c70-86d9-1cb466a9eb08"><div class="source">https://github.com/WazeHell/vulnerable-AD</div></figure><p id="967a3a52-fa95-4f43-918b-3f7039ce4e8d" class="">
</p><p id="4f0ee3da-c16b-42a5-bd4f-c58b3e1be262" class="">Once our Active Directory lab is setup we simply run the Powershell script with the option of the domain name and the tool will create sample users and make configurations to the following areas in order to make the lab vulnerable for testing and demonstration purposes.</p><p id="310fd014-68e6-43d3-8bcc-13bbaaa7e4d4" class="">
</p><p id="95c731dc-2ee9-4dbe-b11b-8b4a5a13c265" class=""><strong>Command: </strong></p><pre id="6bc511e7-dcc6-492c-a687-326c307f9e8d" class="code code-wrap"><code>Invoke-VulnAD -UsersLimit 100 -DomainName &quot;csl.local&quot;</code></pre><p id="edc69a24-426a-4778-8871-ab8403afe350" class="">
</p><p id="eecc6312-eb8a-46b8-beee-d1a764f479e4" class="">
</p><h3 id="019fb816-5738-44ad-bf42-5d1c37ce2938" class="">Supported Attacks</h3><ul id="24a4bed3-1403-4a2a-99db-a53ae9bb00cd" class="bulleted-list"><li style="list-style-type:disc">Abusing ACLs/ACEs</li></ul><ul id="c5f7ec1c-a8a9-4a1f-9593-3b5407868b5f" class="bulleted-list"><li style="list-style-type:disc">Kerberoasting</li></ul><ul id="385ed968-1428-4866-8ba1-de5584c4e672" class="bulleted-list"><li style="list-style-type:disc">AS-REP Roasting</li></ul><ul id="cdd09e4d-df73-4de7-b726-ded74b58123f" class="bulleted-list"><li style="list-style-type:disc">Abuse DnsAdmins</li></ul><ul id="5521ab83-343c-46c4-8c59-d4c06b7fdf31" class="bulleted-list"><li style="list-style-type:disc">Password in Object Description</li></ul><ul id="7bf742c2-c814-45fc-a186-8b39e8a18b36" class="bulleted-list"><li style="list-style-type:disc">User Objects With Default password (Changeme123!)</li></ul><ul id="263b1b7e-4b61-402b-9dc0-05dca7523918" class="bulleted-list"><li style="list-style-type:disc">Password Spraying</li></ul><ul id="6a6ed5a2-b86c-4348-bc45-df9836f8dab0" class="bulleted-list"><li style="list-style-type:disc">DCSync</li></ul><ul id="684a311a-c529-492e-a214-d28bbc10727e" class="bulleted-list"><li style="list-style-type:disc">Silver Ticket</li></ul><ul id="64f7b2b4-8248-4e1a-b347-28b4244eea4f" class="bulleted-list"><li style="list-style-type:disc">Golden Ticket</li></ul><ul id="a98216d0-0e68-49c1-b6ff-0b5448b4abea" class="bulleted-list"><li style="list-style-type:disc">Pass-the-Hash</li></ul><ul id="49fe179a-4380-4abd-bfcf-a245b24aafd5" class="bulleted-list"><li style="list-style-type:disc">Pass-the-Ticket</li></ul><ul id="8c5e5044-ac1d-4e11-97a1-c7f1e9509c73" class="bulleted-list"><li style="list-style-type:disc">SMB Signing Disabled</li></ul><p id="0d24e12b-d925-4634-89e3-b5f1987f54b9" class="">
</p><p id="b631a1bf-cf4e-4f54-b209-9b2be4fc2e36" class="">
</p><p id="ccbb657d-e8c4-41c0-9f5d-52ac60b77c20" class="">Pushing boundaries further, we have introduced MSSQL into the mix to keep things interesting.</p><p id="0e16625a-bce3-4a05-9293-d03382e7cffc" class="">Once MSSQL is installed on a domain joined server, we can configure the server with the following settings as described below.</p><p id="675789b0-4d02-4737-b4e3-f3ae312c8ef4" class="">
</p><p id="c9f6f4fa-4448-4379-b766-fb24f07adcd2" class="">
</p><h3 id="612e51be-e14f-4831-a6ad-92a218eba134" class="">Configure SQLServer TCP/IP settings</h3><p id="0542f41a-00f3-4c4e-b281-7a05ad7d1223" class="">
</p><figure id="59d91b30-9912-4e7e-822d-b945130be4ed" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%201.png"><img style="width:846px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%201.png"/></a></figure><p id="1ceb34e4-2dda-4414-9c6d-8cf622bf50f5" class="">
</p><p id="70729c04-00cc-411a-92b8-f6a201d46415" class="">
</p><figure id="a3c0a04b-fb2d-49e7-b408-2420c06c08e6" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%202.png"><img style="width:792px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%202.png"/></a></figure><p id="aaf4100d-06cf-4146-92a6-2f275ed91550" class="">
</p><figure id="8e1aeb75-8f8c-4af5-a5db-d188d8e4175c" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%203.png"><img style="width:663px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%203.png"/></a></figure><p id="d6e0b64f-f2da-476d-9f63-fa8f863d61cb" class="">
</p><p id="0106ad09-a6ad-4d94-9cb8-7c888ba3d489" class="">
</p><p id="e73b3035-1b8d-4938-8fc0-07d1483705c5" class="">Click Apply after making changes</p><p id="401d8e73-3ff5-4a0e-9592-ef4be4c160c4" class="">
</p><figure id="6fecee15-2093-4b3a-8e31-9a5c88e9a4fc" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%204.png"><img style="width:399px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%204.png"/></a></figure><p id="cba26d24-2d84-4f29-a2ac-92a1902e668c" class="">
</p><p id="c14cdf7e-09ae-4769-9c3e-77d852a57ffe" class="">
</p><p id="248a4b78-a2a7-4f61-8cd4-f0b0ed240dae" class="">
</p><p id="b9c12890-74df-41da-b9b0-02a6d0103594" class="">
</p><h2 id="3e4a391e-624d-4929-bac3-26ef7b8da4da" class="">Setting up the Database</h2><p id="c1eae1b4-9494-474c-b5e7-86e5923a375e" class="">
</p><ol type="1" id="eb37d6e7-0a20-42ce-bbef-30484778f428" class="numbered-list" start="1"><li>Log into the SQL Server with the “sa” account setup during installation using the SQL Server Management Studio application.</li></ol><p id="17e9931c-5929-4922-9f1a-94c8115c9b96" class="">
</p><ol type="1" id="38a7e865-adc2-440e-b2a1-72b759d89db2" class="numbered-list" start="2"><li>Press the “New Query” button and use the TSQL below to create a database named “CSLAppDb” for the lab.</li></ol><p id="e4ae0624-96ee-46e2-9623-76ab1a7dc89b" class="">
</p><pre id="d78001aa-7a0a-4f91-937b-f1a4e31816f3" class="code code-wrap"><code>-- Create database
CREATE DATABASE CSLAppDb</code></pre><p id="f27db0d1-4227-43e1-944e-a2ee091e8b9f" class="">
</p><figure id="73c7b439-d2c4-4b8d-82cf-24189ce165b1" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%205.png"><img style="width:853px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%205.png"/></a></figure><p id="dece7596-2776-40ce-a256-8c98efccd220" class="">
</p><p id="56273dae-757c-410e-8fdc-cc813b2a2bd6" class="">
</p><p id="5d0ae2ff-83f5-430d-8700-c137327bf636" class="">3. Add a table with records.</p><p id="ee7f8f76-ba02-454a-bce0-fb9ff7146c66" class="">
</p><pre id="6a862bdb-4f66-405f-8d02-e1ab0ba4b65d" class="code code-wrap"><code>-- Select the database
USE CSLAppDb
-- Create table
CREATE TABLE dbo.NOCList (ID INT IDENTITY PRIMARY KEY,SpyName varchar(MAX) NOT NULL,RealName varchar(MAX) NULL)
-- Add sample records to table
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;James Bond&#x27;,&#x27;Sean Connery&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Ethan Hunt&#x27;,&#x27;Tom Cruise&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Jason Bourne&#x27;,&#x27;Matt Damon&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Vybz Kartel&#x27;,&#x27;Addijah Palmer&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Gully Gad&#x27;,&#x27;David Brooks&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Drizzy Drake&#x27;,&#x27;Drake Damon&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Ye Yeezy&#x27;,&#x27;Kanye West&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Smokey Smoke&#x27;,&#x27;Chris Tucker&#x27;)
INSERT dbo.NOCList (SpyName, RealName)
VALUES (&#x27;Biggie Smalls&#x27;,&#x27;Christopher Wallace&#x27;)

</code></pre><p id="1ef51b82-6cc5-4b0b-bdac-4ec5eae34edc" class="">
</p><figure id="cf3c5a5f-0ace-4e08-9388-1caad31b1078" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%206.png"><img style="width:901px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%206.png"/></a></figure><p id="73c8e9f5-9f40-40ea-9986-672dc918a91a" class="">
</p><p id="60dcc65c-5815-48b3-b706-0ee28fec2bd2" class="">
</p><p id="4ddaedc2-4954-4341-927e-ea12c45742cd" class="">4. Create a logins for the lab.</p><p id="c01ec041-9843-45fe-9f82-6ea5d17c7b8c" class="">
</p><pre id="1f4ab365-18de-4892-9414-7036c7967284" class="code code-wrap"><code>-- Create login for the web app and direct connection
CREATE LOGIN CSLPublicUser WITH PASSWORD = &#x27;MyPassword!&#x27;;
ALTER LOGIN [CSLPublicUser] with default_database = [CSLAppDb];
CREATE USER [CSLPublicUser] FROM LOGIN [CSLPublicUser];

EXEC sp_addrolemember [db_datareader], [CSLPublicUser];

-- Create login that should not be viewable to CSLPublicUser
CREATE LOGIN MyHiddenUser WITH PASSWORD = &#x27;MyPassword!&#x27;;</code></pre><p id="10757ba3-09b1-4ee2-8ac6-eb1768530f13" class="">
</p><figure id="4fab4904-00da-4c2d-aaf1-b5f2b1eb9e9b" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%207.png"><img style="width:957px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%207.png"/></a></figure><p id="185dc91d-6a62-4302-96af-2ff02bf6c068" class="">
</p><p id="a7f7d4d0-9c56-48ca-b7d8-2c16119f91d9" class="">
</p><p id="6d09f8dc-bbe0-45c1-88f4-5b9229a2898f" class="">5. Verify that the login only has the CONNECT privilege. The CONNECT privilege allows accounts to authenticate to the SQL Server instance.</p><p id="f62ac75a-e942-4d39-8d45-90799c2a8caf" class="">
</p><pre id="7d7d4d55-62e8-4bab-84db-b81436e1c649" class="code code-wrap"><code>-- Impersonate MyPublicUser
EXECUTE AS LOGIN = &#x27;CSLPublicUser&#x27;

-- List privileges
SELECT * FROM fn_my_permissions(NULL, &#x27;SERVER&#x27;);
GO

-- Revert back to sa
REVERT</code></pre><p id="586bdd18-0680-4a7d-b4c4-41bc08065145" class="">
</p><figure id="e9490b8a-143b-443f-91e7-4b3f49749ee0" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%208.png"><img style="width:987px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%208.png"/></a></figure><p id="3b5cd3d3-4786-4645-a1d5-3e8b1d5d2826" class="">
</p><figure id="a30cda57-4ab1-4b28-9d17-d43303d2946e" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%209.png"><img style="width:824px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%209.png"/></a></figure><p id="a52dccee-f439-4688-b4fb-87d1898aaf94" class="">
</p><p id="a2236b78-bcd7-4601-a714-eb90767477e8" class="">6. Check server roles for the CSLPublicUser login. You shouldn’t see any roles assigned to the “CSLPublicUser login.</p><p id="7ced45b7-319a-4d51-84f9-56f3de04c5d7" class="">
</p><pre id="8de6cb5f-f141-4d7d-8dfc-d6a4d355f432" class="code code-wrap"><code>-- Impersonate MyPublicUser
EXECUTE AS LOGIN = &#x27;CSLPublicUser&#x27;

-- Check if the login is part of public
SELECT IS_SRVROLEMEMBER ( &#x27;Public&#x27; )

-- Check other assigned server roles
SELECT PRN.name,
srvrole.name AS [role] ,
Prn.Type_Desc
FROM sys.server_role_members membership
INNER JOIN (SELECT * FROM sys.server_principals WHERE type_desc=&#x27;SERVER_ROLE&#x27;) srvrole
ON srvrole.Principal_id= membership.Role_principal_id
INNER JOIN sys.server_principals PRN
ON PRN.Principal_id= membership.member_principal_id WHERE Prn.Type_Desc NOT IN (&#x27;SERVER_ROLE&#x27;)

REVERT</code></pre><p id="0932187d-2968-483c-8c76-e4b5b518bde1" class="">
</p><figure id="3cadfb21-fd77-4f70-8a0b-28a2e0ade957" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2010.png"><img style="width:998px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2010.png"/></a></figure><p id="374f7592-bdd6-41e7-9c48-a907d083fc16" class="">
</p><p id="9f3d898e-b1b0-432b-b826-16208c1829d4" class="">
</p><h1 id="a2fc7627-5052-4083-b713-6eb46890bbe1" class=""><strong><strong>Setting up the Web Application</strong></strong></h1><p id="bfcd98b7-ceab-4714-868c-384f4d12f454" class="">
</p><ol type="1" id="760dfbdb-fbd9-4754-a2bc-7d0849ee4d0d" class="numbered-list" start="1"><li>Setup a local IIS server</li></ol><ol type="1" id="33560590-3ad3-48e2-93d2-f3a16da8d403" class="numbered-list" start="2"><li>Make sure its configured to process asp pages</li></ol><ol type="1" id="e73e4ed4-3fb8-47e3-b955-86e6c84086b2" class="numbered-list" start="3"><li>Download testing.asp to the web root from:<a href="https://raw.githubusercontent.com/nullbind/Metasploit-Modules/master/testing2.asp">https://raw.githubusercontent.com/nullbind/Metasploit-Modules/master/testing2.asp</a></li></ol><ol type="1" id="6b6f5238-7cf9-4214-b321-ce36eb3610fe" class="numbered-list" start="4"><li>Modify the db_server, db_name,db_username,and db_password variables in testing2.asp as needed.</li></ol><ol type="1" id="a87e699c-b3f4-4cd0-8737-53331a94bb78" class="numbered-list" start="5"><li>Verify the page works by accessing:https://127.0.0.1/testing2.asp?id=1</li></ol><ol type="1" id="fd7a61eb-089c-4de0-ad91-569b33527aca" class="numbered-list" start="6"><li>Verify the id parameter is injectable and error are returned:https://127.0.0.1/testing2.asp?id=@@version</li></ol><p id="92a371fd-0b5f-484c-be36-334d95f5dbcd" class="">
</p><p id="2598f4c8-1c62-48f6-9fc1-966fe9e21a3f" class="">
</p><h3 id="61285d31-a2b7-4000-824c-54eb029adf98" class="">Setup a local IIS server</h3><figure id="63e43f27-26db-4da9-9b2e-9a8d226e4249" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2011.png"><img style="width:836px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2011.png"/></a></figure><p id="0d3f54b5-f4ce-4fce-9418-cb53845a7244" class="">
</p><p id="fa38b416-27d2-4677-b30e-c08d6c042e95" class="">
</p><h3 id="52569202-9d7b-4e9d-a527-19ea03db08b6" class="">Make sure its configured to process asp pages</h3><p id="2c55f0d8-a235-4bbf-951d-6ff95dfbd6e4" class="">
</p><p id="878cec6b-4162-40bc-9f44-ce7577ee6d38" class="">
</p><figure id="f6c4ec53-b86f-4015-9586-b2f78e7fb373" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2012.png"><img style="width:843px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2012.png"/></a></figure><p id="27106739-688d-4747-b287-354a15b3909d" class="">
</p><p id="6607bf11-06ec-4a97-8125-e259ac45d161" class="">
</p><figure id="217e409b-f47c-422b-8f82-8d0a51f92522" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2013.png"><img style="width:843px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2013.png"/></a></figure><p id="ec511dab-4623-4a50-b4c6-543e4dc6b5bc" class="">
</p><p id="91814abe-d415-4e5c-9f68-0a31e3a1e6c9" class="">
</p><h3 id="2150a696-ffc3-4ad6-b851-bba41edeeeb2" class="">Download testing.asp to the web root</h3><p id="5baeca8d-dbbd-408c-8e84-2d624145980c" class="">
</p><pre id="7443eaa6-2fae-4712-95b3-e6cb1d0a4105" class="code code-wrap"><code>iwr -uri https://raw.githubusercontent.com/nullbind/Metasploit-Modules/master/testing2.asp -OutFile testing2.asp</code></pre><p id="1cacf8ee-7f77-43bf-b537-46e21f01bd77" class="">
</p><figure id="4808e18e-c2db-42b2-8236-749c1e3dced3" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2014.png"><img style="width:842px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2014.png"/></a></figure><p id="1fb733f1-0a84-459b-b13c-925c02ba2142" class="">
</p><p id="2fb4f53f-7b69-4f1e-85fa-c2db95e39a32" class="">
</p><h3 id="12b431de-1569-4159-8791-deeea0336788" class="">Modify the db_server, db_name,db_username,and db_password variables in testing2.asp as needed.</h3><p id="2e4fdafc-76b2-44d1-a5b9-ab87f5877132" class="">
</p><figure id="06c2c147-4bc8-4f35-a47d-d18b6f0336b4" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2015.png"><img style="width:592px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2015.png"/></a></figure><p id="49a3c02d-e23a-4548-84e8-f3a174a0cf54" class="">
</p><p id="58e5b53c-7168-44a8-9f3c-7d9e3df4eb53" class="">
</p><h3 id="163dce3c-f884-4a75-aa75-1361e25f43c7" class="">Test ASP Page</h3><p id="0098d50c-c96f-4774-b073-f918e20166d0" class="">
</p><figure id="dff8196a-7acd-47e3-a2b0-ab46a8182581" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2016.png"><img style="width:854px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2016.png"/></a></figure><p id="0017ee93-6962-49ca-ad57-2123fa386527" class="">
</p><p id="662abefe-92e1-45a7-832a-7e031fb3f450" class="">Verify the page works by browsing to the following pages:</p><p id="ff14e14a-fec9-4d2f-86cf-28d6f72ac3e9" class="">
</p><figure id="1e506b35-87fd-472c-bd9e-4c372b6da518" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2017.png"><img style="width:576px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2017.png"/></a></figure><p id="a0a7e5bb-6b08-4b08-b4c1-ce0a447869dc" class="">
</p><p id="fdbbc181-0608-4a2d-be4f-de31b9f276d8" class="">
</p><h3 id="214af05d-dc7f-4cb5-b9dd-73e77ecddad6" class="">Verify the id parameter is injectable and error are returned:</h3><p id="51a2dfe1-4f46-49d6-907f-08fdaded32cc" class="">
</p><figure id="5517a16a-e977-4bd3-b5f7-30b26975c556" class="image"><a href="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2018.png"><img style="width:762px" src="Active%20Directory%20LAB%20-%20MSSQL%20Setup%20c491bef311d24ccea172c4c9e33a7722/Untitled%2018.png"/></a></figure><p id="5ad06204-3a85-451f-8127-0b83636fb955" class="">
</p><p id="d29f59fc-bd2b-4dd9-b954-ff54367f24f6" class="">
</p><p id="0517e76c-7e38-4c03-a9c6-dd3ee9bb07d1" class="">
</p></div></article></body></html>